# 제3강 이더리움 블록채굴과 합의프로토콜1

### 이더리움의 블록 채굴과 합의

- 목적
  - 누구나 블록 생성자(채굴자)로 참여 가능
  - 채굴자들의 합의로 거래들이 블록체인에 저장되는 순서를 정의하고, 동기화된 블록체인 유지를 보장

- 기본 정책

  - 작업 증명(proof of work) 기반의 블록 생성
  - 채굴자에게 블록 인센티브(block incentives) 지불

- 설계 목표

  - 거래 승인 성능 향상

    → 10초 단위의 블록 생성

  - 작업 증명 자원 낭비 축소(블록 생성간격 대비 전달시간 비중 상승에 따른)

    → 수정 GHOST 프로토콜

  - 채굴 역량 집중화 방지(ASIC화에 따른)

    → 메모리 하드(memory-hard) 형 Ethash 작업 증명 알고리즘



### 블록 생성 간격

- 블록 생성 간격과 난이도 조절
  - 블록 생성 간격이 10~19초 이내가 되도록 조정
  - 부모 블록과의 시간 간격이 9초 이하이면 난이도 상향
  - 20초 이상이면 난이도 하향 조정
- 짧은 블록 생성 간격의 문제점
  - 블록 전달지연시간 비중이 커짐
  - 블록 전달시간 동안 생성되는 부실 블록 발생률 상승
- 부실 블록(stale block)
  - 적합하게 생성된 블록이지만 다른 채굴자에 의해 생성된 블록과의 승인 경쟁에서 패배하여 메인 체인에 포함되지 못하고 브랜치에 연결된 블록
- 부실 블록의 문제점
  - 채굴 역량이 높은 채굴자가 다음 블록 채굴 조기 개시확률이 높음
  - 채굴 역량 집중화 심화 초래 → 네트워크 안전성 훼손



### 수정 GHOST 프로토콜

- 이더리움의 수정 GHOST 프로토콜

  - 최장 체인 대신 GHOST 프로토콜을 기본적으로 채택
  - 구현의 복잡성을 고려하여 단순화된 GHOST 프로토콜 적용
  - 삼촌 블록(uncle block) : 수정 GHOST 프로토콜에서 포함하는 부실 블록

  

  

  - 새롭게 생성되는 블록은 부모 블록을 지정하여야 하고, 0~2개까지의 삼촌 블록을 포함할 수 있다.
  - 새로운 블록에 포함되는 삼촌 블록은 2대의 부모 블록부터 시작하여 7대까지의 조상 블록에 직접 연결된 자식 블록이어야 한다.
  - 삼촌 블록은 새로운 블록의 조상 블록이 아니어야 한다.
  - 삼촌 블록은 적합한 블록 헤더를 가져야 한다.
  - 삼촌 블록은 이전 블록에 포함된 블록이 아니어야 하고, 같은 블록에 포함된 다른 블록과 동일하지 않아야 한다.(이중 포함 금지)
  - 삼촌 블록의 채굴자와 삼촌 블록을 포함시키는 블록(조카 블록)의 채굴자는 그에 따른 소정의 블록 인센티브를 지불 받는다.



### 블록 선택 : GHOST 프로토콜

- GHOST(Greedy Heaviest Observed Subtree) 프로토콜
  - 비트코인 : 최장 길이 체인(longest chain)을 메인 체인으로 선택
  - 이더리움 : 가장 무거운 서브 트리(heaviest subtree)의 최장 길이 체인을 메인 체인으로 선택

- GHOST 프로토콜 안전성
  - 공격자가 B2 블록으로 교체하려면 B1 블록 이후에 현재 연결되어 있는 10개의 블록보다 많은 11개 이상의 블록을 생성해야 함
  - 부실 블록이 블록체인 조작 방지에 기여 → 네트워크 안전성 제고
- 부실 브록과 거래의 적합성
  - 메인 체인의 블록의 거래들만 승인된 거래로 인정