# 블록체인과리블제3강 리플 레저

### 리플 레저

- 헤더 구조

  | 필드             | 설명                          |
  | ---------------- | ----------------------------- |
  | ledger-index     | 레저의 순서 번호              |
  | Ledger-hash      | 레저 헤더의 해시값            |
  | Account-hash     | State-tree의 해시값           |
  | Close-time       | 레더 생성 시간                |
  | Parent-hash      | 직전 레저의 해시값            |
  | Torl-colns       | 모든 계좌의 XRP Drop의 전체량 |
  | Transaction-hash | Transaction-tree의 해시값     |

- 레저 생성

  - 생성 간격 : 2~6초
  - 리플 합의 프로토콜 수행 결과에 따라 달라짐
  - 합의 프로토콜 수행 결과 레저 버전 생성이 완료되어 최종 폐쇄 원장(Last Closed Leder)로 확정되면 변경 불가



### 리플 합의 프로토콜

- 목표
  - 정상적인 장애 환경 + 비진틴 장애 환경(공격 등에 의한 장애)에서
  - 20%까지 장애 노드가 존재하는 경우에도 전체 검증 노드들의 합의에 의한 레저 버전(ledger version) 생성
- 기본 개념
  - 각 검증 노드가 신뢰하는 검증 노드들의 집합인 UNL(Unique Node List)의 검증 노드들과 합의 과정 수행
  - 절대 다수(80% 이상)가 검증한 거래들로 구성된 레저버전 생성
  - 검증 노드에 대한 인증 정보 공표
  - UNL간에 20% 이상의 노드가 공유되도록 UNL 구성

- 합의 과정

  1. 각 검증 노드는 수신된 거래들을 검증한 후 모아서 Proposal을 작성하고 UNL의 검증 노드들에게 전달

  2. 다른 노드가 전송한 Proposal들을 분석하여 50% 이상의 노드들에 의해 검증된 거래들로 새로운 Proposal 생성 및 전달
  3. 60%, 70%, 80%로 합의 노드들의 비율을 높이면서 반복
  4. 80% 이상의 노드들이 동의한 거래들로 최종 Proposal 생성 및 전파
  5. 80% 이상의 노드들이 생성한 최종 Proposal이 동일하면 Proposal의 거래들을 이전 Leder에 적용하여 검증하고 결과를 모든 노드에 전달
  6. 80% 이상의 노드들의 검증 결과가 동일하면 레저 버전 생성 완료

- 수신된 거래들을 검증한 후 모아서 Proposal을 작성하고 UNL의 검증 노드들에게 전달ㅍ